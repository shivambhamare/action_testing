      - name: Get previous successful main run
        id: get_prev_run
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          REPO="${{ github.repository }}"
          WORKFLOW_FILE="build-main.yml"

          # Get successful runs on main (previous ones)
          response=$(gh api repos/$REPO/actions/workflows/$WORKFLOW_FILE/runs \
            --field branch=main --field status=success --field per_page=2)

          # Extract second successful run (skip this current run)
          run_id=$(echo "$response" | jq -r '.workflow_runs[1].id // empty')

          if [ -z "$run_id" ] || [ "$run_id" = "null" ]; then
            echo "No previous main run found. Skipping comparison."
            echo "has_prev=false" >> $GITHUB_OUTPUT
          else
            echo "Previous successful main run found: $run_id"
            echo "has_prev=true" >> $GITHUB_OUTPUT
            echo "run_id=$run_id" >> $GITHUB_OUTPUT
          fi
